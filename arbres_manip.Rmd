---
title: "arbres_publics_manip"
author: "Isabel"
date: "01/10/2019"
output:
  html_document:
    keep_md:  true
  editor_options:
    chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Packages et importation des données

```{r loading packages and data, message=FALSE, warning=FALSE, paged.print=FALSE, results="hide"}
#Loading packages
library(tidyverse)
# Import data set
arbres_dataframe  = read_csv("arbres_publics.csv")
```

## Spécification du bon type de variable pour chaque colonne

```{r type de variables, message=FALSE, warning=FALSE, results="hide"}
arbres_dataframe$EMP_NO = arbres_dataframe$EMP_NO %>%  as.character()
arbres_dataframe$ARROND = arbres_dataframe$ARROND %>% as.character()
arbres_dataframe$No_civique = arbres_dataframe$No_civique %>% as.integer()
```

# Exploration du data set

## Combien d'espèces différentes d'arbres sont répertoriés ?

```{r Nombre especes}
# Nombre d'espèces répertoriées avec le nom latin
  n_distinct(arbres_dataframe$Essence_latin, na.rm = TRUE)
# Nombre d'espèces répertoriées avec le nom Français
  n_distinct(arbres_dataframe$Essence_fr, na.rm = TRUE)
# Nombre d'espèces répertoriées avec le nom Anglais
  n_distinct(arbres_dataframe$ESSENCE_ANG, na.rm = TRUE)
```
Le nombre d'espèces changent avec la langue utilisée pour les identifier... Nous allons donc utiliser le nom latin pour la suite.

# Nombre d'arbes répertoriés pour chaque arrondissement.

```{r Liste des arrondissements}
arbres_dataframe %>%
# Regroupement par arrondissement
  group_by(ARROND_NOM) %>%
# Nombre d'observations
  summarise(n_observations = n()) %>%
# Ordre dédroissant
  arrange(desc(n_observations)) 
```
L'arrondissement où il y a le plus grand nombre d'abres répertoriés est Ahuntsic-Cartierville.

# Nettoyage des données
Il y a très peu d'arbres répertoriés pour certain arrondissement (< 18 pour Anjou et Montréal-Est). J'ai choisi de les retirer de l'analyse.

```{r Supression de certains arrondissements, results="hide"}
arbres_dataframe %>%
# Sélection des lignes où le nom d'arrondissement n'est pas Anjou ou Montréal-Est
  filter(ARROND_NOM != "Anjou" & ARROND_NOM != "Montréal-Est") %>% 
  group_by(ARROND_NOM) %>%
  summarise(n_observations = n()) %>% 
  arrange(desc(n_observations))
```

# Dans quels arrondissement y a-t-il la plus grande diversitée ?

## Nombre d'espèces
```{r nb especes}
arbres_dataframe %>%
  filter(ARROND_NOM != "Anjou" & ARROND_NOM != "Montréal-Est") %>% 
  group_by(ARROND_NOM) %>%
  summarise(n_observations = n(), n_especes = n_distinct(Essence_latin, na.rm = TRUE)) %>%
  arrange(desc(n_especes)) 
```

## Graphique montrant la diversité d'arbres par arrondissement

```{r Plot nb arbre nb especes}
# vecteur pour ordonner l'axe des x du graphique (pas la meilleur façcon de faire ça...)
level_order = c('1','2','3','4','5','6','7','8','9','12','13','16','25','27')
# J'ai décidé d'utiliser le numéro d'arrondissement ici pour alléger le graphique (la variable ARROND au lieu de ARROND_NOM)
arbres_dataframe %>% 
  group_by(ARROND) %>%
  summarise(n_observations = n(), n_especes = n_distinct(Essence_latin, na.rm = TRUE)) %>%
# J'ai ainsi mis le filtre sur le nombre d'observations pour exclures les deux même arrondissements, ça allège le code en même temps.
  filter(n_observations > 18) %>%
  ggplot(aes(x = factor(ARROND, level = level_order), y = n_observations, fill = n_especes)) +
  geom_bar(stat = "identity")
```

